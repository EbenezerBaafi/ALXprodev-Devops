#!/bin/bash
# Api endpoint for pikachu

API_URL="https://pokeapi.co/api/v2/pokemon/pikachu"

# Output file
DATA_FILE="data.json"
ERROR_FILE="errors.txt"

# Make api request and save response
response=$(curl -s -w "\n%{http_code}" "$API_URL")

# Extract http status code, last line
http_code=$(echo "response" | tail -n 1)

# Extract response body (everything except last line)
body=$(echo "respponse" | sed '$d')

# Check if request was successful (status code 200)
if [ "http_code" -eq 200]; then
    # Save response body to data file
    echo "$body" > "$DATA_FILE"
    echo "Success, pikachu data saved to $DATA_FILE"
else
    # Save error message to error file
    timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    echo "[$timestamp] Error: HTTP $http_code - failed to retrieve pikachu data" >> "$ERROR_FILE"
    echo "Error: request failed with http status code $http_code"
    echor "Error lodged to $ERROR_FILE"
    exit 1
fi